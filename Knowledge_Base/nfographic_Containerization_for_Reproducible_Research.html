<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographic: Containerization for Reproducible Research (with AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .kpi-card {
            background-color: #003f5c;
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        .kpi-number {
            font-size: 4rem;
            font-weight: 900;
            line-height: 1;
            color: #ffa600;
        }
        .kpi-label {
            margin-top: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
        }
        .flowchart-step {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 2px solid #374c80;
            background-color: #ffffff;
            color: #003f5c;
            padding: 1rem;
            border-radius: 0.5rem;
            min-height: 100px;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .flowchart-arrow {
            font-size: 2.5rem;
            color: #7a5195;
            font-weight: 900;
            align-self: center;
        }
        .ai-generator .tab-btn {
            transition: all 0.3s ease;
        }
        .ai-generator .tab-btn.active {
            background-color: #003f5c;
            color: white;
        }
        .ai-generator .tab-btn:not(.active) {
            background-color: #e2e8f0;
            color: #475569;
        }
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            width: 16px;
            height: 16px;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            width: 90%;
            max-width: 500px;
        }
        .example-tab-btn {
            transition: all 0.2s ease-in-out;
            color: #4b5563;
        }
        .example-tab-btn.active {
            border-color: #7a5195;
            color: #7a5195;
            font-weight: 700;
        }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-[#003f5c] text-white p-8 text-center shadow-lg">
        <h1 class="text-4xl md:text-5xl font-bold mb-2">Encapsulating Discovery</h1>
        <p class="text-xl md:text-2xl font-light text-gray-200">A Guide to Containerization for Reproducible Research</p>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="crisis" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-2 text-[#003f5c]">The Crisis of Confidence in Computational Science</h2>
            <p class="text-lg text-center max-w-3xl mx-auto mb-8 text-gray-600">A foundational principle of science is reproducibility, yet a significant portion of computational research cannot be reliably reproduced. This erodes trust and hinders scientific progress.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="kpi-card">
                    <div class="kpi-number">70%</div>
                    <div class="kpi-label">of researchers have failed to reproduce another's experiment.</div>
                    <p class="text-sm mt-2 text-gray-300">(Source: Nature, 2016)</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-center mb-4">Primary Roots of Irreproducibility</h3>
                    <div class="chart-container">
                        <canvas id="reproducibilityCrisisChart"></canvas>
                    </div>
                    <p class="text-center text-sm mt-4 text-gray-500">The "works on my machine" syndrome is a major, addressable cause.</p>
                </div>
            </div>
        </section>

        <section id="workflow" class="mb-16 bg-white p-6 md:p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-center mb-2 text-[#003f5c]">The Ideal Research Workflow</h2>
            <p class="text-lg text-center max-w-3xl mx-auto mb-8 text-gray-600">This workflow synthesizes the best tools: using the universal standard for definition, a secure engine for building, and a high-performance engine for execution.</p>
            <div class="grid grid-cols-1 md:grid-cols-7 gap-4 items-stretch">
                <div class="flowchart-step md:col-span-2"><span>1. Define with <br><b>Dockerfile</b></span></div>
                <div class="flowchart-arrow hidden md:flex items-center justify-center">→</div>
                <div class="flowchart-step md:col-span-2"><span>2. Build Securely with <br><b>Podman</b> (or Docker)</span></div>
                <div class="flowchart-arrow hidden md:flex items-center justify-center">→</div>
                <div class="flowchart-step md:col-span-2"><span>3. Execute at Scale with <br><b>Singularity</b> on HPC</span></div>
            </div>
        </section>

        <section id="ai-generator" class="mb-16 ai-generator bg-[#003f5c] p-6 md:p-8 rounded-lg shadow-2xl text-white">
            <h2 class="text-3xl font-bold text-center mb-2 text-white">✨ Interactive Environment Generator</h2>
            <p class="text-lg text-center max-w-3xl mx-auto mb-6 text-gray-300">Describe your project, and let Gemini AI create a starting point for your container definition file.</p>
            <div class="max-w-4xl mx-auto bg-white/10 p-6 rounded-lg">
                <div class="flex border-b border-gray-500 mb-4"><button id="docker-tab" class="tab-btn active py-2 px-4 font-semibold rounded-t-lg">Dockerfile</button><button id="singularity-tab" class="tab-btn py-2 px-4 font-semibold rounded-t-lg">Singularity</button></div>
                <div><label for="ai-prompt" class="block mb-2 font-semibold text-gray-200">Describe your project requirements:</label><textarea id="ai-prompt" rows="4" class="w-full p-3 rounded-md bg-gray-900/50 text-white border border-gray-600 focus:ring-2 focus:ring-[#ffa600] focus:outline-none" placeholder="e.g., A Python 3.10 app using pandas and scikit-learn. The main script is 'analysis.py' and it reads data from a 'data' directory."></textarea></div>
                <div class="text-center mt-4"><button id="generate-btn" class="bg-[#ffa600] text-[#003f5c] font-bold py-3 px-8 rounded-lg shadow-md hover:bg-yellow-400 transition-colors duration-300 inline-flex items-center gap-2"><span id="generate-btn-text">Generate</span><div id="generate-spinner" class="spinner hidden"></div></button></div>
                <div class="mt-6"><div class="flex justify-between items-center mb-2"><h3 class="font-semibold text-gray-200">Generated Output:</h3><button id="copy-btn" class="bg-gray-600/50 hover:bg-gray-500/50 text-white text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy Code</button></div><pre id="ai-output-container" class="bg-gray-900/70 p-4 rounded-md overflow-x-auto min-h-[200px] border border-gray-700"><code id="ai-output" class="language-dockerfile text-gray-300 whitespace-pre-wrap">Your generated code will appear here...</code></pre></div>
            </div>
        </section>

        <!-- Code Examples Section -->
        <section id="code-examples" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">Practical Code Examples</h2>
            <div class="flex justify-center border-b border-gray-200 mb-8">
                <button data-target="workstation-content" class="example-tab-btn active py-2 px-6 font-semibold border-b-4">Workstation</button>
                <button data-target="hpc-content" class="example-tab-btn py-2 px-6 font-semibold border-b-4 border-transparent">HPC</button>
                <button data-target="k8s-content" class="example-tab-btn py-2 px-6 font-semibold border-b-4 border-transparent">Kubernetes</button>
            </div>

            <div id="workstation-content" class="example-content space-y-8">
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Multi-Stage Dockerfile (Python)</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-dockerfile"># Stage 1: Build the environment with dependencies
FROM python:3.10-slim AS builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir --user -r requirements.txt

# Stage 2: Final image with only code and installed packages
FROM python:3.10-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
# Add local packages to PATH
ENV PATH=/root/.local/bin:$PATH
CMD ["python", "./your_script.py"]</code></pre>
                </div>
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Docker Build & Run Commands</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-bash"># Build the Docker image
docker build -t my-research-app .

# Run the container for analysis
# -v $(pwd):/app mounts current directory for interactive development
docker run --rm -it -v $(pwd):/app my-research-app</code></pre>
                </div>
                 <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Docker Compose (Web App + Database)</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-yaml">services:
  web:
    build: .
    ports:
      - "8000:5000"
    volumes:
      - .:/code
    depends_on:
      - db
  db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=myuser
      - POSTGRES_PASSWORD=mypass
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:</code></pre>
                </div>
            </div>

            <div id="hpc-content" class="example-content hidden space-y-8">
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Singularity Definition File</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-singularity">Bootstrap: docker
From: ubuntu:22.04

%post
    apt-get update && apt-get install -y python3 python3-pip
    pip3 install numpy pandas
    
%runscript
    echo "Container is running! Python packages are installed."
    exec python3 "$@"</code></pre>
                </div>
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Slurm Script (Standard CPU Job)</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-bash">#!/bin/bash
#SBATCH --job-name=singularity_cpu_job
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=4
#SBATCH --mem=8G
#SBATCH --time=01:00:00

module load singularity
IMAGE_PATH="/path/to/your/image.sif"

singularity exec $IMAGE_PATH \
  python3 /path/in/container/to/script.py --input /data --output /results</code></pre>
                </div>
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Slurm Script (GPU Job)</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-bash">#!/bin/bash
#SBATCH --job-name=singularity_gpu_job
#SBATCH --partition=gpu
#SBATCH --gres=gpu:1
#SBATCH --mem=32G
#SBATCH --time=04:00:00

module load singularity
IMAGE_PATH="/path/to/your/gpu_image.sif"

# The --nv flag enables NVIDIA GPU access inside the container
singularity exec --nv $IMAGE_PATH \
  python3 /path/in/container/to/train_model.py</code></pre>
                </div>
            </div>
            
            <div id="k8s-content" class="example-content hidden space-y-8">
                 <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Kubernetes Deployment YAML</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: research-app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: research-app
  template:
    metadata:
      labels:
        app: research-app
    spec:
      containers:
      - name: research-container
        image: your-repo/my-research-image:1.0
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"</code></pre>
                </div>
                <div class="code-block-wrapper bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-2"><h4 class="font-bold text-lg text-[#374c80]">Kubernetes Service & kubectl Commands</h4><button class="copy-code-btn bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-semibold py-1 px-3 rounded-md transition-colors">Copy</button></div>
                    <pre class="bg-gray-100 text-sm p-4 rounded-md overflow-x-auto"><code class="language-bash"># --- service.yaml ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: research-app-service
# spec:
#   selector:
#     app: research-app
#   ports:
#     - protocol: TCP
#       port: 80
#       targetPort: 80
#   type: LoadBalancer

# --- kubectl commands ---
# Apply the configuration
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml

# Check the status
kubectl get deployments
kubectl get pods
kubectl get service</code></pre>
                </div>
            </div>
        </section>

        <section id="fair" class="mb-16 bg-white p-6 md:p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-center mb-2 text-[#003f5c]">The FAIR Principles: A Framework for Solutions</h2>
            <p class="text-lg text-center max-w-3xl mx-auto mb-8 text-gray-600">Containerization provides a direct solution by making computational workflows Findable, Accessible, Interoperable, and Reusable (FAIR).</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="border-l-4 border-[#bc5090] p-4 bg-gray-50 rounded"><h3 class="text-2xl font-bold text-[#bc5090]">Findable</h3><p class="mt-2 text-gray-700">Images are stored in registries with unique tags.</p></div>
                <div class="border-l-4 border-[#ef5675] p-4 bg-gray-50 rounded"><h3 class="text-2xl font-bold text-[#ef5675]">Accessible</h3><p class="mt-2 text-gray-700">The entire stack runs with one command.</p></div>
                <div class="border-l-4 border-[#ff764a] p-4 bg-gray-50 rounded"><h3 class="text-2xl font-bold text-[#ff764a]">Interoperable</h3><p class="mt-2 text-gray-700">Standardized formats run across platforms.</p></div>
                <div class="border-l-4 border-[#ffa600] p-4 bg-gray-50 rounded"><h3 class="text-2xl font-bold text-[#ffa600]">Reusable</h3><p class="mt-2 text-gray-700">Encapsulation ensures reliability over time.</p></div>
            </div>
        </section>

        <section id="optimization" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 text-[#003f5c]">Best Practices for Image Optimization</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold text-center mb-4">Minimize Image Size with Multi-Stage Builds</h3><div class="chart-container"><canvas id="imageSizeChart"></canvas></div><p class="text-center text-sm mt-4 text-gray-500">Separating build dependencies from runtime needs dramatically reduces image size.</p></div>
                <div class="bg-white p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold text-center mb-4">Optimize Build Cache & Context</h3><p class="text-lg text-gray-600 mb-4">Two simple changes produce massive gains in build speed.</p><div class="space-y-4"><div class="p-4 rounded bg-gray-100"><h4 class="font-bold text-[#374c80]">1. Master Layer Caching</h4><p>Order instructions from least to most frequently changing.</p></div><div class="p-4 rounded bg-gray-100"><h4 class="font-bold text-[#374c80]">2. Use `.dockerignore`</h4><p>Exclude unneeded files from the build context.</p></div></div></div>
            </div>
        </section>
    </main>
    
    <div id="message-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="text-xl font-bold mb-4 text-[#003f5c]">Notification</h3>
            <p id="modal-message" class="text-gray-700"></p>
            <div class="text-right mt-6"><button id="modal-close-btn" class="bg-[#003f5c] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#374c80]">Close</button></div>
        </div>
    </div>

    <footer class="bg-[#003f5c] text-white text-center p-4 mt-8">
        <p>&copy; 2025 Reproducible Research Initiative. Infographic enhanced with Gemini AI.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const colorPalette = { blue: '#003f5c', purple: '#7a5195', pink: '#bc5090', red: '#ef5675', orange: '#ff764a', yellow: '#ffa600', teal: '#374c80' };
            const tooltipTitleCallback = (tooltipItems) => { const item = tooltipItems[0]; let label = item.chart.data.labels[item.dataIndex]; return Array.isArray(label) ? label.join(' ') : label; };
            const defaultPlugins = { legend: { position: 'top' }, tooltip: { callbacks: { title: tooltipTitleCallback } } };
            new Chart(document.getElementById('reproducibilityCrisisChart'), { type: 'doughnut', data: { labels: ['Computational Complexity', 'Methodological Flaws', 'Systemic Pressures'], datasets: [{ data: [45, 35, 20], backgroundColor: [colorPalette.blue, colorPalette.purple, colorPalette.red], borderColor: '#ffffff', borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { title: tooltipTitleCallback } } } } });
            new Chart(document.getElementById('imageSizeChart'), { type: 'bar', data: { labels: ['Go Application', 'Python/ML App'], datasets: [{ label: 'Single-Stage Build', data: [980, 2500], backgroundColor: colorPalette.red }, { label: 'Multi-Stage Build', data: [15, 600], backgroundColor: colorPalette.blue }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Image Size (MB)' } } }, plugins: defaultPlugins } });

            const dockerTab = document.getElementById('docker-tab');
            const singularityTab = document.getElementById('singularity-tab');
            const aiPrompt = document.getElementById('ai-prompt');
            const generateBtn = document.getElementById('generate-btn');
            const generateBtnText = document.getElementById('generate-btn-text');
            const generateSpinner = document.getElementById('generate-spinner');
            const aiOutput = document.getElementById('ai-output');
            const copyBtn = document.getElementById('copy-btn');
            const messageModal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            let activeTab = 'docker';

            const showModal = (title, message) => { modalTitle.textContent = title; modalMessage.textContent = message; messageModal.classList.remove('hidden'); };
            modalCloseBtn.addEventListener('click', () => messageModal.classList.add('hidden'));
            messageModal.addEventListener('click', (e) => { if (e.target === messageModal) { messageModal.classList.add('hidden'); } });

            dockerTab.addEventListener('click', () => { activeTab = 'docker'; dockerTab.classList.add('active'); singularityTab.classList.remove('active'); aiOutput.className = 'language-dockerfile text-gray-300 whitespace-pre-wrap'; });
            singularityTab.addEventListener('click', () => { activeTab = 'singularity'; singularityTab.classList.add('active'); dockerTab.classList.remove('active'); aiOutput.className = 'language-singularity text-gray-300 whitespace-pre-wrap'; });
            
            copyBtn.addEventListener('click', () => {
                const textToCopy = aiOutput.textContent;
                if(textToCopy === 'Your generated code will appear here...') { showModal('Info', 'Nothing to copy yet. Please generate some code first.'); return; }
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); showModal('Success', 'Code copied to clipboard!'); } catch (err) { showModal('Error', 'Failed to copy code.'); }
                document.body.removeChild(textArea);
            });

            generateBtn.addEventListener('click', async () => {
                const userInput = aiPrompt.value.trim();
                if (!userInput) { showModal('Input Required', 'Please describe your project requirements.'); return; }
                generateBtn.disabled = true; generateBtnText.classList.add('hidden'); generateSpinner.classList.remove('hidden'); aiOutput.textContent = 'Generating...';
                let systemPrompt = activeTab === 'docker' ? "You are an expert in containerization. Generate a best-practice, multi-stage, optimized Dockerfile based on the user's request. Add comments explaining each step. Ensure the final image is as small and secure as possible." : "You are an expert in HPC and containerization. Generate a best-practice Singularity Definition File (.def) based on the user's request. Bootstrap from an appropriate Docker image.";
                const fullPrompt = `${systemPrompt}\n\nUser Request: "${userInput}"`;
                try {
                    let chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { throw new Error(`API request failed with status ${response.status}`); }
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts.length > 0) {
                        let text = result.candidates[0].content.parts[0].text;
                        text = text.replace(/```(dockerfile|bash|singularity|yaml)?\n?/g, '').replace(/```/g, '');
                        aiOutput.textContent = text.trim();
                    } else { throw new Error("No content received from API."); }
                } catch (error) { aiOutput.textContent = 'An error occurred. Please check the console.'; showModal('API Error', `Failed to generate content. ${error.message}.`); } 
                finally { generateBtn.disabled = false; generateBtnText.classList.remove('hidden'); generateSpinner.classList.add('hidden'); }
            });

            // Code Examples Section Logic
            const exampleTabs = document.querySelectorAll('.example-tab-btn');
            const exampleContents = document.querySelectorAll('.example-content');
            exampleTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    exampleTabs.forEach(t => t.classList.remove('active'));
                    exampleContents.forEach(c => c.classList.add('hidden'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.remove('hidden');
                });
            });

            document.querySelectorAll('.copy-code-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const codeBlock = e.target.closest('.code-block-wrapper').querySelector('pre');
                    const textToCopy = codeBlock.textContent;
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try { document.execCommand('copy'); showModal('Success', 'Code copied to clipboard!'); } catch (err) { showModal('Error', 'Failed to copy code.'); }
                    document.body.removeChild(textArea);
                });
            });
        });
    </script>
</body>
</html>
